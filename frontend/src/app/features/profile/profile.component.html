<ng-container *ngIf="userProfile$ | async as user">

  <div class="profile-page">

    <a routerLink="/" class="home-link inline-block p-4 absolute top-0 left-0 z-10">
      <img
        class="arrow-icon h-6 w-6 text-white filter drop-shadow(0 1px 1px rgba(0,0,0,0.7))" src="assets/images/arrow-left-solid-full.svg"
        alt="Volver al Home">
    </a>

    <div class="profile-header-container border-b border-gray-700 pb-4"> <div class="profile-banner relative">
         <img *ngIf="bannerPreviewUrl"
              [src]="bannerPreviewUrl"
              alt="Previsualización Banner"
              class="w-full h-48 object-cover">
         <img *ngIf="!bannerPreviewUrl"
              [src]="user.banner ? (user.banner.url_banners | mediaUrl:cacheBustTs) : 'assets/images/images.png'"
              alt="Banner de {{ user.name }}"
              class="w-full h-48 object-cover">

        <label *ngIf="isOwnProfile && !selectedBannerFile && !isUploadingBanner"
               for="bannerInput"
               class="absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center opacity-0 hover:opacity-100 cursor-pointer transition-opacity group">
          <div class="text-center">
             <svg class="w-8 h-8 text-white mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z" /> <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z" /> </svg>
             <span class="mt-1 text-white text-sm font-semibold block">Cambiar Banner</span>
          </div>
          </label>
         <div *ngIf="isUploadingBanner" class="absolute inset-0 bg-black bg-opacity-70 flex items-center justify-center"> <p class="text-white animate-pulse">Subiendo...</p> </div>

          <div *ngIf="selectedBannerFile && !isUploadingBanner && isOwnProfile"
               class="absolute bottom-2 right-2 z-10 space-x-2">
                 <button (click)="onUploadBanner()"
                         class="bg-green-600 hover:bg-green-700 text-white text-xs py-1 px-3 rounded shadow transition-colors"> Confirmar Banner </button>
                 <button (click)="cancelBannerChange()"
                         class="bg-red-600 hover:bg-red-700 text-white text-xs py-1 px-3 rounded shadow transition-colors"> Cancelar </button>
          </div>
      </div> <div class="px-4 relative">
        <div class="profile-avatar relative w-24 h-24 rounded-full overflow-hidden border-4 border-gray-900 -mt-12 z-10">
           <img *ngIf="avatarPreviewUrl" [src]="avatarPreviewUrl" alt="Previsualización Avatar" class="w-full h-full object-cover">
           <img *ngIf="!avatarPreviewUrl" [src]="user.avatar ? (user.avatar.url_avatars | mediaUrl:cacheBustTs) : 'assets/images/iconousuario.png'" alt="Avatar de {{ user.name }}" class="w-full h-full object-cover">
           <label *ngIf="isOwnProfile && !selectedAvatarFile && !isUploadingAvatar" for="avatarInput" class="absolute inset-0 bg-black bg-opacity-30 rounded-full flex items-center justify-center opacity-0 hover:opacity-100 cursor-pointer transition-opacity group">
               <svg class="w-6 h-6 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" d="M6.827 6.175A2.31 2.31 0 015.186 7.23c-.38.054-.757.112-1.134.175C2.999 7.58 2.25 8.507 2.25 9.574V18a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 18V9.574c0-1.067-.75-1.994-1.802-2.169a47.865 47.865 0 00-1.134-.175 2.31 2.31 0 01-1.64-1.055l-.822-1.316a2.192 2.192 0 00-1.736-1.039 48.774 48.774 0 00-5.232 0 2.192 2.192 0 00-1.736 1.039l-.821 1.316z" /> <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 12.75a4.5 4.5 0 11-9 0 4.5 4.5 0 019 0zM18.75 10.5h.008v.008h-.008V10.5z" /> </svg>
           </label>
            <div *ngIf="isUploadingAvatar" class="absolute inset-0 bg-black bg-opacity-70 rounded-full flex items-center justify-center"> <p class="text-white text-xs animate-pulse">Subiendo...</p> </div>
        </div>

        <div class="profile-actions absolute top-0 right-4 mt-20" *ngIf="isOwnProfile">
          <button (click)="toggleEditProfile()" class="btn btn-edit bg-gray-900 border border-gray-700 text-white py-0.5 px-3 rounded-full text-sm hover:bg-gray-700">
            {{ isEditingProfile ? 'Cerrar edición' : 'Editar Perfil' }}
          </button>
        </div>
        
        <!-- Botón Seguir / Dejar de seguir para perfiles ajenos -->
        <div class="absolute top-0 right-4 mt-20" *ngIf="!isOwnProfile && user">
          <button (click)="toggleFollow()"
                  class="py-1 px-4 rounded-full text-sm font-semibold border transition-colors"
                  [ngClass]="isFollowing ? 'bg-gray-800 border-gray-600 text-white hover:bg-gray-700' : 'bg-white text-black border-white hover:bg-gray-200'">
            {{ isFollowing ? 'Siguiendo' : 'Seguir' }}
          </button>
        </div>
        <div class="mt-2">
           <h2 class="name text-xl font-bold">{{ user.name }}</h2>
           <p class="username text-sm text-gray-400">@{{ user.username }}</p>

           <p class="joined-date text-sm text-gray-500 mt-1">
             <svg class="inline-block w-4 h-4 mr-1 align-text-bottom" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5m-9-6h.008v.008H12v-.008zM12 15h.008v.008H12V15zm0 2.25h.008v.008H12v-.008zm0 2.25h.008v.008H12v-.008zM9.75 15h.008v.008H9.75V15zm0 2.25h.008v.008H9.75v-.008zM7.5 15h.008v.008H7.5V15zm0 2.25h.008v.008H7.5v-.008zm6.75-4.5h.008v.008h-.008v-.008zm0 2.25h.008v.008H16.5v-.008zm0 2.25h.008v.008H16.5V15z" /> </svg>
             Unido a Bait en {{ user.created_at | date:'MMMM yyyy' }}
           </p>
          
           <div class="flex items-center space-x-4 mt-2 text-sm">
             <span><span class="font-semibold">{{ user.following_count || 0 }}</span> Siguiendo</span>
             <span><span class="font-semibold">{{ user.followers_count || 0 }}</span> Seguidores</span>
           </div>
           
           <div *ngIf="selectedAvatarFile && !isUploadingAvatar && isOwnProfile" class="mt-2 space-x-2">
                 <button (click)="onUploadAvatar()" class="bg-green-600 hover:bg-green-700 text-white text-xs py-1 px-3 rounded transition-colors"> Confirmar Avatar </button>
                 <button (click)="cancelAvatarChange()" class="bg-red-600 hover:bg-red-700 text-white text-xs py-1 px-3 rounded transition-colors"> Cancelar </button>
           </div>
        </div>

        </div> </div> <input *ngIf="isOwnProfile" type="file" id="avatarInput" accept="image/*" (change)="onAvatarSelected($event)" class="hidden">
    <input *ngIf="isOwnProfile" type="file" id="bannerInput" accept="image/*" (change)="onBannerSelected($event)" class="hidden">

    <!-- Tabs -->
    <div class="tabs border-b border-gray-700 flex sticky top-0 bg-gray-900 z-10">
      <button (click)="selectTab('posts')"
              [class.border-blue-500]="currentTab === 'posts'" [class.font-semibold]="currentTab === 'posts'"
              [class.text-white]="currentTab === 'posts'" [class.text-gray-500]="currentTab !== 'posts'"
              class="flex-1 p-4 text-sm hover:bg-gray-800 text-center border-b-2 transition-colors focus:outline-none">
        Posts
      </button>
      <button (click)="selectTab('reposts')"
              [class.border-blue-500]="currentTab === 'reposts'" [class.font-semibold]="currentTab === 'reposts'"
              [class.text-white]="currentTab === 'reposts'" [class.text-gray-500]="currentTab !== 'reposts'"
              class="flex-1 p-4 text-sm hover:bg-gray-800 text-center border-b-2 transition-colors focus:outline-none">
        Reposts
      </button>
    </div>

    <!-- Vista de edición a pantalla completa en la columna central -->
    <div *ngIf="isEditingProfile" class="px-4 py-4 space-y-6">
      <div class="bg-gray-900/40 rounded-lg border border-gray-700 p-4">
        <h3 class="text-white font-semibold mb-3">Editar datos del perfil</h3>
        <form [formGroup]="profileForm" (ngSubmit)="onSubmitProfile()" class="space-y-3">
          <div>
            <label class="block text-sm text-gray-400 mb-1">Nombre</label>
            <input formControlName="name" type="text" class="w-full bg-gray-800 text-white rounded px-3 py-2 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" />
            <div *ngIf="profileForm.get('name')?.invalid && (profileForm.get('name')?.dirty || profileForm.get('name')?.touched)" class="text-xs text-red-400 mt-1">
              <span *ngIf="profileForm.get('name')?.errors?.['required']">El nombre es obligatorio.</span>
              <span *ngIf="profileForm.get('name')?.errors?.['maxlength']">Máximo 100 caracteres.</span>
            </div>
          </div>
          <div>
            <label class="block text-sm text-gray-400 mb-1">Email</label>
            <input formControlName="email" type="email" class="w-full bg-gray-800 text-white rounded px-3 py-2 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" />
            <div *ngIf="profileForm.get('email')?.invalid && (profileForm.get('email')?.dirty || profileForm.get('email')?.touched)" class="text-xs text-red-400 mt-1">
              <span *ngIf="profileForm.get('email')?.errors?.['required']">El email es obligatorio.</span>
              <span *ngIf="profileForm.get('email')?.errors?.['email']">Formato de email inválido.</span>
            </div>
          </div>
          <div>
            <label class="block text-sm text-gray-400 mb-1">Username (opcional)</label>
            <input formControlName="username" type="text" class="w-full bg-gray-800 text-white rounded px-3 py-2 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" />
          </div>
          <div *ngIf="apiErrorsProfile" class="text-xs text-red-400 space-y-1">
            <div *ngIf="apiErrorsProfile.name"><span *ngFor="let e of apiErrorsProfile.name">{{ e }}</span></div>
            <div *ngIf="apiErrorsProfile.email"><span *ngFor="let e of apiErrorsProfile.email">{{ e }}</span></div>
            <div *ngIf="apiErrorsProfile.username"><span *ngFor="let e of apiErrorsProfile.username">{{ e }}</span></div>
            <div *ngIf="apiErrorsProfile.general"><span *ngFor="let e of apiErrorsProfile.general">{{ e }}</span></div>
          </div>
          <div class="pt-2">
            <button type="submit" [disabled]="submittingProfile || profileForm.invalid" class="bg-blue-600 hover:bg-blue-700 disabled:opacity-50 text-white font-semibold px-4 py-2 rounded">
              {{ submittingProfile ? 'Guardando...' : 'Guardar cambios' }}
            </button>
            <button type="button" (click)="cancelEditProfile()" class="ml-2 border border-gray-600 text-white px-4 py-2 rounded hover:bg-gray-800">Cancelar</button>
          </div>
        </form>
      </div>

      <div class="bg-gray-900/40 rounded-lg border border-gray-700 p-4">
        <h3 class="text-white font-semibold mb-3">Cambiar contraseña</h3>
        <form [formGroup]="passwordForm" (ngSubmit)="onSubmitPassword()" class="space-y-3">
          <div>
            <label class="block text-sm text-gray-400 mb-1">Contraseña actual</label>
            <input formControlName="current_password" type="password" class="w-full bg-gray-800 text-white rounded px-3 py-2 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" />
          </div>
          <div>
            <label class="block text-sm text-gray-400 mb-1">Nueva contraseña</label>
            <input formControlName="new_password" type="password" class="w-full bg-gray-800 text-white rounded px-3 py-2 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" />
            <div *ngIf="passwordForm.get('new_password')?.invalid && (passwordForm.get('new_password')?.dirty || passwordForm.get('new_password')?.touched)" class="text-xs text-red-400 mt-1">
              <span *ngIf="passwordForm.get('new_password')?.errors?.['required']">La nueva contraseña es obligatoria.</span>
              <span *ngIf="passwordForm.get('new_password')?.errors?.['minlength']">Mínimo 8 caracteres.</span>
            </div>
          </div>
          <div>
            <label class="block text-sm text-gray-400 mb-1">Confirmar nueva contraseña</label>
            <input formControlName="new_password_confirmation" type="password" class="w-full bg-gray-800 text-white rounded px-3 py-2 border border-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500" />
          </div>
          <div *ngIf="apiErrorsPassword" class="text-xs text-red-400 space-y-1">
            <div *ngIf="apiErrorsPassword.current_password"><span *ngFor="let e of apiErrorsPassword.current_password">{{ e }}</span></div>
            <div *ngIf="apiErrorsPassword.new_password"><span *ngFor="let e of apiErrorsPassword.new_password">{{ e }}</span></div>
            <div *ngIf="apiErrorsPassword.new_password_confirmation"><span *ngFor="let e of apiErrorsPassword.new_password_confirmation">{{ e }}</span></div>
            <div *ngIf="apiErrorsPassword.general"><span *ngFor="let e of apiErrorsPassword.general">{{ e }}</span></div>
          </div>
          <div class="pt-2">
            <button type="submit" [disabled]="submittingPassword || passwordForm.invalid" class="bg-blue-600 hover:bg-blue-700 disabled:opacity-50 text-white font-semibold px-4 py-2 rounded">
              {{ submittingPassword ? 'Actualizando...' : 'Actualizar contraseña' }}
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Vista de posts cuando no está en edición -->
    <div *ngIf="!isEditingProfile && currentTab === 'posts'" class="divide-y divide-gray-700">

      <div *ngFor="let post of userPosts" class="p-4 transition-colors duration-150">
        <div class="flex justify-between">
          <div class="flex items-center space-x-3">
              <img class="w-10 h-10 rounded-full"
                   [src]="post.user?.avatar?.url_avatars ? (post.user?.avatar?.url_avatars | mediaUrl:cacheBustTs) : 'assets/images/iconousuario.png'"
                   alt="Avatar de {{ post.user?.name || 'Usuario' }}">
              <div>
                  <a [routerLink]="['/profile', post.user?.username]" class="font-semibold text-sm hover:underline text-white">{{ post.user?.name || 'Usuario' }}</a>
                  <span class="text-sm text-gray-400 ml-1">@{{ post.user?.username || 'usuario' }}</span>
                  <span class="text-sm text-gray-500 ml-2">· {{ post.created_at | date:'short' }}</span>
              </div>
          </div>

          <div *ngIf="currentUserId && currentUserId === post.user_id" class="relative">
              <button (click)="togglePostMenu(post.id)" class="text-gray-400 hover:text-white p-1 rounded-full transition-colors"> <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Zm0 6a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Zm0 6a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z" /> </svg> </button>
              <div *ngIf="openPostId === post.id" class="absolute bottom-full right-0 z-10 mb-1 w-32 bg-gray-800 rounded-lg shadow-lg border border-gray-700">
                <ul class="py-1">
                  <li>
                    <button (click)="startEditPost(post)" class="w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700">Editar</button>
                  </li>
                  <li>
                    <button (click)="onDeletePost(post.id)" class="w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700">Eliminar</button>
                  </li>
                </ul>
              </div>
          </div>
        </div>

        <div *ngIf="editingPostId === post.id; else viewPostContentProfile">
          <textarea class="w-full bg-gray-800 text-gray-100 rounded p-2 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                    rows="3"
                    [value]="editContent"
                    (input)="editContent = $any($event.target).value"></textarea>
          <div class="mt-2 flex gap-2">
            <button (click)="saveEditPost(post)" class="bg-blue-600 hover:bg-blue-700 text-white text-sm px-3 py-1 rounded">Guardar</button>
            <button (click)="cancelEditPost()" class="border border-gray-600 text-white text-sm px-3 py-1 rounded hover:bg-gray-800">Cancelar</button>
          </div>
        </div>
        <ng-template #viewPostContentProfile>
          <p class="mt-3 text-sm whitespace-pre-wrap">{{ post.content_posts }}</p>
        </ng-template>

        <div *ngIf="post.multimedia_contents && post.multimedia_contents.length > 0" class="mt-3">
            <img [src]="post.multimedia_contents[0].url_content | mediaUrl:cacheBustTs" alt="Imagen del post" class="max-h-96 rounded-lg border border-gray-700">
         </div>

        <div class="flex justify-around mt-4 text-gray-500">
          <button class="flex items-center space-x-1 group focus:outline-none">
            <div class="p-2 rounded-full group-hover:bg-blue-500/10 transition-colors"><svg class="w-5 h-5 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4-.01-18zM18 14H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/></svg></div>
            <span class="text-xs group-hover:text-blue-500">{{ post.comments_count || 0 }}</span>
          </button>
          <button (click)="onToggleRepost(post)" class="flex items-center space-x-1 group focus:outline-none">
            <div class="p-2 rounded-full group-hover:bg-green-500/10 transition-colors"><svg class="w-5 h-5 group-hover:text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg></div>
            <span class="text-xs group-hover:text-green-500">{{ post.reposts_count || 0 }}</span>
          </button>
          <button (click)="onToggleLike(post)" class="flex items-center space-x-1 group focus:outline-none" [class.text-blue-500]="post.is_liked_by_user">
            <div class="p-2 rounded-full group-hover:bg-blue-500/10 transition-colors"><svg class="w-5 h-5" [class.fill-blue-500]="post.is_liked_by_user" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></div>
            <span class="text-xs">{{ post.reactions_count || 0 }}</span>
          </button>
        </div>

      </div>
      <div *ngIf="!userPosts || userPosts.length === 0" class="p-4 text-center text-gray-500"> <p>Este usuario aún no ha posteado nada.</p> </div>

    </div>

    <!-- Vista de reposts -->
    <div *ngIf="!isEditingProfile && currentTab === 'reposts'" class="divide-y divide-gray-700">
      <div *ngFor="let post of userReposts" class="p-4 hover:bg-gray-800/50 transition-colors duration-150">
        <div class="text-xs text-gray-400 flex items-center mb-2">
          <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg>
          Repost
        </div>
        <div class="flex justify-between">
          <div class="flex items-center space-x-3">
              <img class="w-10 h-10 rounded-full"
                   [src]="post.user?.avatar?.url_avatars ? (post.user?.avatar?.url_avatars | mediaUrl:cacheBustTs) : 'assets/images/iconousuario.png'"
                   alt="Avatar de {{ post.user?.name || 'Usuario' }}">
              <div>
                  <a [routerLink]="['/profile', post.user?.username]" class="font-semibold text-sm hover:underline text-white">{{ post.user?.name || 'Usuario' }}</a>
                  <span class="text-sm text-gray-400 ml-1">@{{ post.user?.username || 'usuario' }}</span>
                  <span class="text-sm text-gray-500 ml-2">· {{ post.created_at | date:'short' }}</span>
              </div>
          </div>

          <div *ngIf="currentUserId && currentUserId === post.user_id" class="relative">
              <button (click)="togglePostMenu(post.id)" class="text-gray-400 hover:text-white p-1 rounded-full transition-colors"> <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"> <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Zm0 6a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Zm0 6a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z" /> </svg> </button>
              <div *ngIf="openPostId === post.id" class="absolute bottom-full right-0 z-10 mb-1 w-32 bg-gray-800 rounded-lg shadow-lg border border-gray-700">
                <ul class="py-1">
                  <li>
                    <button (click)="startEditPost(post)" class="w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700">Editar</button>
                  </li>
                  <li>
                    <button (click)="onDeletePost(post.id)" class="w-full text-left px-4 py-2 text-sm text-white hover:bg-gray-700">Eliminar</button>
                  </li>
                </ul>
              </div>
          </div>
        </div>

        <p class="mt-3 text-sm whitespace-pre-wrap">{{ post.content_posts }}</p>

        <div *ngIf="post.multimedia_contents && post.multimedia_contents.length > 0" class="mt-3">
            <img [src]="post.multimedia_contents[0].url_content | mediaUrl:cacheBustTs" alt="Imagen del post" class="max-h-96 rounded-lg border border-gray-700">
        </div>

        <div class="flex justify-around mt-4 text-gray-500">
          <button class="flex items-center space-x-1 group focus:outline-none">
            <div class="p-2 rounded-full group-hover:bg-blue-500/10 transition-colors"><svg class="w-5 h-5 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21.99 4c0-1.1-.89-2-1.99-2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4-.01-18zM18 14H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/></svg></div>
            <span class="text-xs group-hover:text-blue-500">{{ post.comments_count || 0 }}</span>
          </button>
          <button (click)="onToggleRepost(post)" class="flex items-center space-x-1 group focus:outline-none">
            <div class="p-2 rounded-full group-hover:bg-green-500/10 transition-colors"><svg class="w-5 h-5 group-hover:text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/></svg></div>
            <span class="text-xs group-hover:text-green-500">{{ post.reposts_count || 0 }}</span>
          </button>
          <button (click)="onToggleLike(post)" class="flex items-center space-x-1 group focus:outline-none" [class.text-blue-500]="post.is_liked_by_user">
            <div class="p-2 rounded-full group-hover:bg-blue-500/10 transition-colors"><svg class="w-5 h-5" [class.fill-blue-500]="post.is_liked_by_user" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></div>
            <span class="text-xs">{{ post.reactions_count || 0 }}</span>
          </button>
        </div>
      </div>
      <div *ngIf="!userReposts || userReposts.length === 0" class="p-4 text-center text-gray-500"> <p>Este usuario aún no tiene reposts.</p> </div>
    </div>

<ng-template #loadingTpl>
  <p class="p-4 text-center">Cargando perfil...</p>
</ng-template>